<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>更新记录 - 极简工具箱</title>
    <style>
        :root {
            --bg: #f3f6fb;
            --surface: #ffffff;
            --surface-soft: #f8fafc;
            --line: #dbe3ef;
            --text: #0f172a;
            --text-soft: #475569;
            --primary: #2563eb;
            --primary-soft: #dbeafe;
            --success: #16a34a;
            --shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
            --radius-lg: 16px;
            --radius-md: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", "Noto Sans SC", "Helvetica Neue", sans-serif;
            color: var(--text);
            background:
                radial-gradient(1200px 600px at 110% -20%, rgba(37, 99, 235, 0.12), transparent 60%),
                radial-gradient(900px 500px at -10% 0%, rgba(59, 130, 246, 0.08), transparent 60%),
                var(--bg);
            min-height: 100vh;
            padding: 28px 16px;
        }

        .container {
            max-width: 1080px;
            margin: 0 auto;
        }

        .hero {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            border-radius: var(--radius-lg);
            color: #fff;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 16px;
        }

        .hero h1 {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 0.01em;
            margin-bottom: 8px;
        }

        .hero p {
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.95rem;
            line-height: 1.65;
        }

        .stat-grid {
            margin-top: 16px;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
        }

        .stat-card {
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 12px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.78);
            font-size: 0.78rem;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.06rem;
            font-weight: 700;
            word-break: break-word;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            background: var(--surface);
            border: 1px solid var(--line);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            padding: 12px;
            margin-bottom: 16px;
        }

        .control {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--surface-soft);
            border: 1px solid var(--line);
            border-radius: 10px;
            padding: 0 10px;
            min-height: 40px;
        }

        .control label {
            color: var(--text-soft);
            font-size: 0.84rem;
            white-space: nowrap;
        }

        .control input,
        .control select {
            border: none;
            background: transparent;
            outline: none;
            color: var(--text);
            min-width: 170px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(#bfdbfe, #93c5fd);
        }

        .item {
            position: relative;
            background: var(--surface);
            border: 1px solid var(--line);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            margin-bottom: 12px;
            padding: 14px;
        }

        .item::before {
            content: '';
            position: absolute;
            left: -21px;
            top: 18px;
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-soft);
        }

        .item-top {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .hash {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            color: var(--primary);
            background: var(--primary-soft);
            border-radius: 999px;
            padding: 2px 10px;
            font-size: 0.82rem;
            font-weight: 600;
        }

        .date {
            color: var(--text-soft);
            font-size: 0.82rem;
        }

        .subject {
            font-size: 0.97rem;
            line-height: 1.65;
            margin-bottom: 8px;
        }

        .meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .author {
            color: var(--text-soft);
            font-size: 0.84rem;
        }

        .tag {
            color: var(--success);
            background: #dcfce7;
            border: 1px solid #bbf7d0;
            border-radius: 999px;
            font-size: 0.75rem;
            padding: 2px 8px;
            font-weight: 600;
        }

        .empty {
            border: 1px dashed var(--line);
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 24px;
            text-align: center;
            color: var(--text-soft);
        }

        @media (max-width: 760px) {
            body {
                padding: 14px 10px;
            }

            .hero {
                padding: 16px;
            }

            .hero h1 {
                font-size: 1.3rem;
            }

            .stat-grid {
                grid-template-columns: 1fr;
            }

            .control {
                flex: 1;
            }

            .control input,
            .control select {
                min-width: 0;
                width: 100%;
            }
        }

        ::-webkit-scrollbar { width: 7px; height: 7px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(128,128,128,0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(128,128,128,0.5); }
    </style>
</head>
<body>
<div class="container">
    <section class="hero">
        <h1>更新记录</h1>
        <p>同步展示当前仓库的 Git 提交历史，采用时间线视图，便于快速回看版本迭代。</p>
        <div class="stat-grid">
            <div class="stat-card">
                <p class="stat-label">提交总数</p>
                <p class="stat-value" id="statTotal">-</p>
            </div>
            <div class="stat-card">
                <p class="stat-label">最近提交时间</p>
                <p class="stat-value" id="statLatest">-</p>
            </div>
            <div class="stat-card">
                <p class="stat-label">数据更新时间</p>
                <p class="stat-value" id="statGenerated">-</p>
            </div>
        </div>
    </section>

    <section class="toolbar">
        <div class="control">
            <label for="keywordInput">搜索</label>
            <input id="keywordInput" type="text" placeholder="输入提交说明关键词">
        </div>
        <div class="control">
            <label for="authorSelect">作者</label>
            <select id="authorSelect">
                <option value="">全部作者</option>
            </select>
        </div>
    </section>

    <section id="list" class="timeline"></section>
</div>

<script>
    const listEl = document.getElementById('list');
    const statTotalEl = document.getElementById('statTotal');
    const statLatestEl = document.getElementById('statLatest');
    const statGeneratedEl = document.getElementById('statGenerated');
    const keywordInputEl = document.getElementById('keywordInput');
    const authorSelectEl = document.getElementById('authorSelect');

    let allCommits = [];

    function formatDate(iso) {
        const date = new Date(iso);
        if (Number.isNaN(date.getTime())) return iso || '-';
        return date.toLocaleString('zh-CN', {
            hour12: false,
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
    }

    function escapeHtml(text) {
        return String(text)
            .replaceAll('&', '&amp;')
            .replaceAll('<', '&lt;')
            .replaceAll('>', '&gt;')
            .replaceAll('"', '&quot;')
            .replaceAll("'", '&#39;');
    }

    function getFilteredCommits() {
        const keyword = keywordInputEl.value.trim().toLowerCase();
        const author = authorSelectEl.value;
        return allCommits.filter((commit) => {
            const authorOk = !author || (commit.author || '') === author;
            const subject = (commit.subject || '').toLowerCase();
            const hash = (commit.shortHash || '').toLowerCase();
            const keywordOk = !keyword || subject.includes(keyword) || hash.includes(keyword);
            return authorOk && keywordOk;
        });
    }

    function render(commits) {
        if (!Array.isArray(commits) || commits.length === 0) {
            listEl.innerHTML = '<div class="empty">未匹配到提交记录，请调整搜索条件。</div>';
            return;
        }

        listEl.innerHTML = commits.map((commit) => {
            const subject = escapeHtml(commit.subject || '(无提交说明)');
            const author = escapeHtml(commit.author || 'Unknown');
            const shortHash = escapeHtml(commit.shortHash || '');
            const fullHash = escapeHtml(commit.hash || '');
            const dateText = formatDate(commit.date || '');

            return `
                <article class="item">
                    <div class="item-top">
                        <span class="hash" title="${fullHash}">${shortHash}</span>
                        <time class="date">${dateText}</time>
                    </div>
                    <p class="subject">${subject}</p>
                    <div class="meta">
                        <p class="author">作者：${author}</p>
                        <span class="tag">已发布</span>
                    </div>
                </article>
            `;
        }).join('');
    }

    function refreshView() {
        render(getFilteredCommits());
    }

    function initAuthors(commits) {
        const authors = Array.from(new Set((commits || []).map(item => item.author).filter(Boolean))).sort((a, b) => a.localeCompare(b));
        authorSelectEl.innerHTML = '<option value="">全部作者</option>' + authors
            .map((author) => `<option value="${escapeHtml(author)}">${escapeHtml(author)}</option>`)
            .join('');
    }

    fetch('json/更新记录.json', {cache: 'no-store'})
        .then((res) => {
            if (!res.ok) {
                throw new Error('HTTP ' + res.status);
            }
            return res.json();
        })
        .then((data) => {
            allCommits = Array.isArray(data.commits) ? data.commits : [];
            statTotalEl.textContent = String(data.total || allCommits.length || 0);
            statLatestEl.textContent = allCommits.length ? formatDate(allCommits[0].date) : '-';
            statGeneratedEl.textContent = formatDate(data.generatedAt);
            initAuthors(allCommits);
            refreshView();
        })
        .catch((err) => {
            statTotalEl.textContent = '0';
            statLatestEl.textContent = '-';
            statGeneratedEl.textContent = '-';
            listEl.innerHTML = `<div class="empty">无法加载 json/更新记录.json：${escapeHtml(err.message)}</div>`;
        });

    keywordInputEl.addEventListener('input', refreshView);
    authorSelectEl.addEventListener('change', refreshView);
</script>
</body>
</html>
