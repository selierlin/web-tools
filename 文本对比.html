<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>文本对比系统</title>
    <style>
        :root {
            --neon-blue: #00d2ff;
            --neon-purple: #9d50bb;
            --neon-green: #00ff88;
            --neon-red: #ff0055;
            --bg-dark: #0a0c10;
            --panel-bg: rgba(16, 20, 28, 0.8);
            --border-glow: rgba(0, 210, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Fira Code', monospace;
            -webkit-tap-highlight-color: transparent;
        }

        /* 动态赛博背景 */
        body {
            background: var(--bg-dark);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            color: #e2e8f0;
        }

        body::before {
            content: "";
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: cover;
            animation: flow 20s infinite alternate;
            z-index: -1;
            opacity: 0.15;
        }

        @keyframes flow {
            0% { transform: translate(-25%, -25%) rotate(0deg); }
            100% { transform: translate(0%, 0%) rotate(10deg); }
        }

        .container {
            width: 95vw;
            height: 90vh;
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* 顶部流光条 */
        .container::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-blue), var(--neon-purple), transparent);
        }

        /* 导航栏 */
        .tool-header {
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            flex-wrap: wrap;
            gap: 10px;
        }

        .tool-title {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: 1px;
            background: linear-gradient(to right, var(--neon-blue), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 8px var(--border-glow));
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        #compareBtn {
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
            color: white;
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.3);
        }

        #compareBtn:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        #clearBtn {
            background: rgba(255, 255, 255, 0.05);
            color: #ccc;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 面板区域 */
        .compare-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .text-panel {
            flex: 1;
            display: flex;
            background: rgba(0, 0, 0, 0.15);
            position: relative;
        }

        .text-panel:first-child {
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* 行号 */
        .line-numbers {
            width: 45px;
            padding-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            color: #4b5563;
            font-size: 11px;
            text-align: center;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
            user-select: none;
        }

        .line-num {
            height: 28px;
            line-height: 28px;
        }

        /* 编辑区 */
        .text-editor {
            flex: 1;
            padding: 20px 0;
            overflow: auto;
        }

        textarea, .editable-div {
            width: 100%;
            height: 100%;
            padding: 0 15px;
            background: transparent;
            border: none;
            outline: none;
            color: #cbd5e1;
            font-size: 14px;
            line-height: 28px;
            white-space: pre;
            tab-size: 4;
            resize: none;
        }

        /* 差异高亮 */
        .text-line {
            padding: 0 15px;
            min-height: 28px;
            border-left: 3px solid transparent;
        }

        .diff-added {
            background: rgba(0, 255, 136, 0.08);
            color: var(--neon-green);
            border-left: 3px solid var(--neon-green);
            display: block;
            margin-left: -15px;
            padding-left: 12px;
        }

        .diff-removed {
            background: rgba(255, 0, 85, 0.08);
            color: var(--neon-red);
            border-left: 3px solid var(--neon-red);
            display: block;
            margin-left: -15px;
            padding-left: 12px;
        }

        /* --- 手机端适配关键修改 --- */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .container {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
            }

            .tool-header {
                padding: 10px 15px;
            }

            .tool-title {
                font-size: 16px;
            }

            .btn-group button span {
                display: none; /* 极窄屏幕隐藏按钮文字只留图标 */
            }

            .compare-content {
                flex-direction: column; /* 纵向堆叠 */
            }

            .text-panel:first-child {
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .line-numbers {
                width: 35px; /* 进一步缩小行号栏 */
            }

            .text-editor {
                padding: 10px 0;
            }

            textarea, .editable-div {
                font-size: 13px; /* 缩小字号适配屏幕 */
                padding: 0 10px;
            }

            .text-line {
                padding: 0 10px;
            }

            .diff-added, .diff-removed {
                margin-left: -10px;
                padding-left: 7px;
            }
        }

        /* 滚动条 */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
    </style>
</head>
<body>

<div class="container">
    <header class="tool-header">
        <div class="tool-title">文本对比系统 v1.0</div>
        <div class="btn-group">
            <button id="clearBtn">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                </svg>
                <span>清空内容</span>
            </button>
            <button id="compareBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                <span>执行对比</span>
            </button>
            <button id="backToEditBtn" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                <span>返回编辑</span>
            </button>
        </div>
    </header>

    <main class="compare-content">
        <div class="text-panel" id="leftPanel">
            <div class="line-numbers" id="leftLineNumbers"></div>
            <div class="text-editor" id="leftTextEditor">
                <textarea id="leftText" placeholder="// 请在此输入或粘贴原始内容..."></textarea>
            </div>
        </div>
        <div class="text-panel" id="rightPanel">
            <div class="line-numbers" id="rightLineNumbers"></div>
            <div class="text-editor" id="rightTextEditor">
                <textarea id="rightText" placeholder="// 请在此输入或粘贴修改后的内容..."></textarea>
            </div>
        </div>
    </main>
</div>

<script>
    // 逻辑部分完全保留，未作修改
    const leftText = document.getElementById('leftText');
    const rightText = document.getElementById('rightText');
    const leftLineNumbers = document.getElementById('leftLineNumbers');
    const rightLineNumbers = document.getElementById('rightLineNumbers');
    const leftTextEditor = document.getElementById('leftTextEditor');
    const rightTextEditor = document.getElementById('rightTextEditor');
    const compareBtn = document.getElementById('compareBtn');
    const clearBtn = document.getElementById('clearBtn');
    const backToEditBtn = document.getElementById('backToEditBtn');

    let isReplaced = { left: false, right: false };

    function syncLineNumbers() {
        const getCount = (side) => {
            if (isReplaced[side]) {
                const el = document.getElementById(`${side}TextEditable`);
                return el ? el.children.length : 1;
            }
            const val = (side === 'left' ? leftText.value : rightText.value);
            return val ? val.split('\n').length : 1;
        };

        renderLines(leftLineNumbers, getCount('left'));
        renderLines(rightLineNumbers, getCount('right'));
    }

    function renderLines(el, count) {
        el.innerHTML = Array.from({length: count}, (_, i) => `<div class="line-num">${i+1}</div>`).join('');
    }

    leftTextEditor.onscroll = () => { leftLineNumbers.scrollTop = leftTextEditor.scrollTop; };
    rightTextEditor.onscroll = () => { rightLineNumbers.scrollTop = rightTextEditor.scrollTop; };

    function compare() {
        const lVal = isReplaced.left ? document.getElementById('leftTextEditable').innerText : leftText.value;
        const rVal = isReplaced.right ? document.getElementById('rightTextEditable').innerText : rightText.value;

        if (!lVal && !rVal) return;

        const lLines = lVal.split('\n');
        const rLines = rVal.split('\n');
        const max = Math.max(lLines.length, rLines.length);

        let lHtml = '', rHtml = '';

        for (let i = 0; i < max; i++) {
            const l = lLines[i] || '';
            const r = rLines[i] || '';

            if (l !== r) {
                lHtml += `<div class="text-line ${l ? 'diff-removed' : ''}">${escape(l)}</div>`;
                rHtml += `<div class="text-line ${r ? 'diff-added' : ''}">${escape(r)}</div>`;
            } else {
                lHtml += `<div class="text-line">${escape(l)}</div>`;
                rHtml += `<div class="text-line">${escape(r)}</div>`;
            }
        }

        updatePanel('left', lHtml);
        updatePanel('right', rHtml);
        syncLineNumbers();
        backToEditBtn.style.display = 'inline-flex';
    }

    function updatePanel(side, html) {
        const editor = side === 'left' ? leftTextEditor : rightTextEditor;
        editor.innerHTML = `<div id="${side}TextEditable" class="editable-div" contenteditable="false">${html}</div>`;
        isReplaced[side] = true;
    }

    function escape(s) {
        return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }

    clearBtn.onclick = () => {
        leftTextEditor.innerHTML = '';
        leftTextEditor.appendChild(leftText);
        rightTextEditor.innerHTML = '';
        rightTextEditor.appendChild(rightText);
        leftText.value = '';
        rightText.value = '';
        isReplaced = { left: false, right: false };
        syncLineNumbers();
        backToEditBtn.style.display = 'none';
    };

    compareBtn.onclick = compare;
    leftText.oninput = syncLineNumbers;
    rightText.oninput = syncLineNumbers;

    backToEditBtn.onclick = () => {
        leftTextEditor.innerHTML = '';
        leftTextEditor.appendChild(leftText);
        rightTextEditor.innerHTML = '';
        rightTextEditor.appendChild(rightText);
        isReplaced = { left: false, right: false };
        syncLineNumbers();
        backToEditBtn.style.display = 'none';
    };

    window.onload = syncLineNumbers;
</script>
</body>
</html>
