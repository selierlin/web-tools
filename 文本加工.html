<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本批量加工处理</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .text-area-group {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            align-items: center;
        }

        @media (max-width: 768px) {
            .text-area-group {
                flex-direction: column;
            }
            .transfer-btn-wrap {
                margin: 1rem 0;
                width: 100%;
            }
        }

        .text-box {
            flex: 1;
        }

        .transfer-btn-wrap {
            display: flex;
            justify-content: center;
            align-items: center;
            min-width: 160px;
        }

        .transfer-btn {
            padding: 0.8rem 1.2rem;
            border: none;
            border-radius: 8px;
            background-color: #1abc9c;
            color: #fff;
            font-size: 1.2rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex !important;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 6px rgba(26, 188, 156, 0.3);
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }

        @media (max-width: 768px) {
            .transfer-btn {
                padding: 0.8rem 1.8rem;
                width: 100%;
                height: auto;
                border-radius: 8px;
            }
        }

        .transfer-btn:hover {
            background-color: #16a085;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(22, 160, 133, 0.4);
        }

        .transfer-btn:active {
            transform: translateY(0);
        }

        .transfer-btn i {
            margin: 0;
        }

        label {
            display: block;
            margin-bottom: 0.8rem;
            color: #34495e;
            font-weight: 500;
            font-size: 1.05rem;
        }

        textarea {
            width: 100%;
            height: 300px;
            padding: 1rem;
            border: 1px solid #dce4ec;
            border-radius: 8px;
            resize: vertical;
            font-size: 1rem;
            color: #2c3e50;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            /* 优化：禁用自动换行，减少渲染压力 */
            white-space: pre;
            overflow-x: auto;
        }

        textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        button {
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: 8px;
            background-color: #34495e;
            color: #fff;
            font-size: 1rem;
            font-weight: 500;
            cursor: not-allowed;
            transition: all 0.3s ease;
            display: none;
        }

        button.active {
            display: block;
            cursor: pointer;
        }

        button#btn1.active {
            background-color: #3498db;
        }

        button#btn1.active:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        button#btn2.active {
            background-color: #2ecc71;
        }

        button#btn2.active:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        button#btn3.active {
            background-color: #e67e22;
        }

        button#btn3.active:hover {
            background-color: #d35400;
            transform: translateY(-2px);
        }

        button#btn4.active {
            background-color: #e74c3c;
        }

        button#btn4.active:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        button.copy-btn {
            display: block;
            background-color: #9b59b6;
            cursor: pointer;
        }

        button.copy-btn:hover {
            background-color: #8e44ad;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .tip {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .quote-select {
            text-align: center;
            margin-bottom: 1rem;
        }

        .quote-select label {
            display: inline-block;
            margin-right: 1rem;
            color: #34495e;
        }

        .quote-select select {
            padding: 0.4rem 0.8rem;
            border: 1px solid #dce4ec;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* 新增：处理中加载提示样式 */
        .loading {
            display: inline-block;
            margin-left: 0.5rem;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>文本批量加工处理</h1>

        <div class="quote-select">
            <label for="quoteType">功能2 - 选择引号类型：</label>
            <select id="quoteType">
                <option value="single">单引号 (')</option>
                <option value="double">双引号 (")</option>
            </select>
        </div>

        <div class="text-area-group">
            <div class="text-box">
                <label for="inputText">输入文本：</label>
                <textarea id="inputText" placeholder="请粘贴需要处理的批量文本..."></textarea>
            </div>

            <div class="transfer-btn-wrap">
                <button class="transfer-btn" id="transferBtn">
                    <i class="fa fa-arrow-left" aria-hidden="true"></i>
                </button>
            </div>

            <div class="text-box">
                <label for="outputText">输出结果：</label>
                <textarea id="outputText" placeholder="处理后的结果将显示在这里..." readonly></textarea>
            </div>
        </div>

        <div class="btn-group">
            <button id="btn1">功能1：多行 → 单行逗号拼接</button>
            <button id="btn2">功能2：多行 → 带引号单行逗号拼接</button>
            <button id="btn3">功能3：单行逗号拼接 → 多行</button>
            <button id="btn4">功能4：带引号逗号拼接 → 无引号多行</button>
            <button class="copy-btn" id="copyBtn">复制输出结果</button>
        </div>

        <div class="tip" id="tipInfo">温馨提示：输入文本后，将自动显示可用功能按钮</div>
    </div>

    <script>
        // 获取DOM元素
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const btn1 = document.getElementById('btn1');
        const btn2 = document.getElementById('btn2');
        const btn3 = document.getElementById('btn3');
        const btn4 = document.getElementById('btn4');
        const copyBtn = document.getElementById('copyBtn');
        const transferBtn = document.getElementById('transferBtn');
        const quoteType = document.getElementById('quoteType');
        const tipInfo = document.getElementById('tipInfo');

        // 工具函数1：节流函数（限制函数执行频率）
        const throttle = (fn, delay = 500) => {
            let timer = null;
            return (...args) => {
                if (timer) return;
                timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = null;
                }, delay);
            };
        };

        // 工具函数2：去除字符串两端空白
        const trimStr = (str) => str.replace(/^\s+|\s+$/g, '');

        // 工具函数3：高性能批量文本处理（替换数组高阶函数，使用for循环）
        const batchProcessText = {
            // 功能1：多行 → 单行逗号拼接
            multiToSingle: (text) => {
                const lines = text.split(/\r?\n/);
                const result = [];
                // 使用for循环，减少函数调用开销
                for (let i = 0, len = lines.length; i < len; i++) {
                    const line = trimStr(lines[i]);
                    if (line) result.push(line);
                }
                return result.join(',');
            },

            // 功能2：多行 → 带引号单行逗号拼接
            multiToSingleWithQuote: (text, quote) => {
                const lines = text.split(/\r?\n/);
                const result = [];
                for (let i = 0, len = lines.length; i < len; i++) {
                    const line = trimStr(lines[i]);
                    if (line) result.push(`${quote}${line}${quote}`);
                }
                return result.join(',');
            },

            // 功能3：单行逗号拼接 → 多行
            singleToMulti: (text) => {
                const items = text.split(',');
                const result = [];
                for (let i = 0, len = items.length; i < len; i++) {
                    const item = trimStr(items[i]);
                    if (item) result.push(item);
                }
                return result.join('\n');
            },

            // 功能4：带引号逗号拼接 → 无引号多行
            singleQuotedToMultiUnquoted: (text) => {
                // 先批量去除引号，再分割
                const withoutQuotes = text.replace(/["']/g, '');
                const items = withoutQuotes.split(',');
                const result = [];
                for (let i = 0, len = items.length; i < len; i++) {
                    const item = trimStr(items[i]);
                    if (item) result.push(item);
                }
                return result.join('\n');
            }
        };

        // 提示信息显示函数
        const showTip = (message, color) => {
            tipInfo.textContent = message;
            tipInfo.style.color = color;

            setTimeout(() => {
                const inputVal = trimStr(inputText.value);
                if (!inputVal) {
                    tipInfo.textContent = '温馨提示：输入文本后，将自动显示可用功能按钮';
                    tipInfo.style.color = '#7f8c8d';
                }
            }, 3000);
        };

        // 核心逻辑：判断输入类型，动态显示按钮（添加节流优化）
        const judgeInputTypeAndShowButtons = () => {
            btn1.classList.remove('active');
            btn2.classList.remove('active');
            btn3.classList.remove('active');
            btn4.classList.remove('active');

            const inputVal = trimStr(inputText.value);
            if (!inputVal) {
                showTip('温馨提示：输入文本后，将自动显示可用功能按钮', '#7f8c8d');
                return;
            }

            const isMultiLine = inputVal.includes('\n');
            const isSingleLineWithComma = !isMultiLine && inputVal.includes(',');
            const isQuotedSingleLine = isSingleLineWithComma && (inputVal.includes('"') || inputVal.includes("'"));

            if (isMultiLine) {
                btn1.classList.add('active');
                btn2.classList.add('active');
                showTip('检测到多行文本，可使用功能1、功能2进行处理', '#3498db');
            } else if (isQuotedSingleLine) {
                btn3.classList.add('active');
                btn4.classList.add('active');
                showTip('检测到带引号逗号拼接文本，可使用功能3、功能4进行处理', '#e74c3c');
            } else if (isSingleLineWithComma) {
                btn3.classList.add('active');
                showTip('检测到单行逗号拼接文本，可使用功能3进行处理', '#e67e22');
            } else {
                btn1.classList.add('active');
                btn2.classList.add('active');
                btn3.classList.add('active');
                btn4.classList.add('active');
                showTip('检测到单行无逗号文本，所有功能均可用', '#2ecc71');
            }
        };

        // 包装节流函数，限制判断逻辑执行频率
        const throttledJudge = throttle(judgeInputTypeAndShowButtons, 600);

        // 新增：粘贴事件监听，专门处理批量粘贴场景
        inputText.addEventListener('paste', (e) => {
            // 粘贴完成后延迟执行判断（确保数据已完整写入textarea）
            setTimeout(() => {
                judgeInputTypeAndShowButtons();
                showTip('批量文本粘贴完成，可进行后续处理', '#16a085');
            }, 100);
        });

        // 监听输入变化（使用节流后的函数）
        inputText.addEventListener('input', throttledJudge);

        // 页面初始化执行一次判断
        judgeInputTypeAndShowButtons();

        // 回传按钮点击事件（优化：批量赋值，仅触发一次DOM更新）
        transferBtn.addEventListener('click', () => {
            const outputVal = outputText.value;
            const validOutputVal = trimStr(outputVal);

            if (!validOutputVal) {
                showTip('输出区域无有效内容可转移！', 'red');
                return;
            }

            // 优化：先清空输入框，再一次性赋值（减少DOM操作）
            inputText.value = '';
            inputText.value = outputVal;
            // 触发判断（使用节流函数，避免重复执行）
            throttledJudge();
            showTip('输出结果已成功转移到输入文本，可进行二次加工！', '#16a085');
        });

        // 功能1：优化后批量处理
        btn1.addEventListener('click', () => {
            const inputVal = inputText.value;
            if (!trimStr(inputVal)) {
                showTip('请先输入需要处理的文本！', 'red');
                return;
            }

            // 显示处理中提示
            showTip('正在处理大量数据，请稍候...', '#3498db');
            // 优化：使用requestIdleCallback或setTimeout，避免阻塞主线程
            setTimeout(() => {
                try {
                    const result = batchProcessText.multiToSingle(inputVal);
                    // 一次性赋值给输出框，仅触发1次DOM重排
                    outputText.value = result;
                    showTip('功能1处理完成！（数据已批量转换）', '#27ae60');
                } catch (err) {
                    showTip('处理失败！请检查数据格式', 'red');
                    console.error('处理失败：', err);
                }
            }, 0);
        });

        // 功能2：优化后批量处理
        btn2.addEventListener('click', () => {
            const inputVal = inputText.value;
            if (!trimStr(inputVal)) {
                showTip('请先输入需要处理的文本！', 'red');
                return;
            }

            showTip('正在处理大量数据，请稍候...', '#2ecc71');
            setTimeout(() => {
                try {
                    const quote = quoteType.value === 'single' ? "'" : '"';
                    const result = batchProcessText.multiToSingleWithQuote(inputVal, quote);
                    outputText.value = result;
                    showTip('功能2处理完成！（数据已批量转换）', '#27ae60');
                } catch (err) {
                    showTip('处理失败！请检查数据格式', 'red');
                    console.error('处理失败：', err);
                }
            }, 0);
        });

        // 功能3：优化后批量处理
        btn3.addEventListener('click', () => {
            const inputVal = inputText.value;
            if (!trimStr(inputVal)) {
                showTip('请先输入需要处理的文本！', 'red');
                return;
            }

            showTip('正在处理大量数据，请稍候...', '#e67e22');
            setTimeout(() => {
                try {
                    const result = batchProcessText.singleToMulti(inputVal);
                    outputText.value = result;
                    showTip('功能3处理完成！（数据已批量转换）', '#27ae60');
                } catch (err) {
                    showTip('处理失败！请检查数据格式', 'red');
                    console.error('处理失败：', err);
                }
            }, 0);
        });

        // 功能4：优化后批量处理
        btn4.addEventListener('click', () => {
            const inputVal = inputText.value;
            if (!trimStr(inputVal)) {
                showTip('请先输入需要处理的文本！', 'red');
                return;
            }

            showTip('正在处理大量数据，请稍候...', '#e74c3c');
            setTimeout(() => {
                try {
                    const result = batchProcessText.singleQuotedToMultiUnquoted(inputVal);
                    outputText.value = result;
                    showTip('功能4处理完成！（数据已批量去引号并转换）', '#e74c3c');
                } catch (err) {
                    showTip('处理失败！请检查数据格式', 'red');
                    console.error('处理失败：', err);
                }
            }, 0);
        });

        // 复制功能（优化：处理大量文本复制）
        copyBtn.addEventListener('click', async () => {
            const outputVal = outputText.value;
            if (!trimStr(outputVal)) {
                showTip('输出区域无有效内容可复制！', 'red');
                return;
            }

            try {
                // 优化：大量文本复制，使用剪贴板API的容错处理
                await navigator.clipboard.writeText(outputVal);
                showTip('复制成功！大量数据已保存到剪贴板', '#9b59b6');
            } catch (err) {
                // 降级方案：手动选中复制
                outputText.select();
                document.execCommand('copy');
                showTip('复制成功（降级方案）！结果已保存到剪贴板', '#9b59b6');
                console.error('剪贴板API失败，使用降级方案：', err);
            }
        });
    </script>
</body>
</html>
